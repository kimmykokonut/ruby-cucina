<div class="max-w-2xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6">Add New Recipe</h1>

    <%= form_with model: @recipe, class: "space-y-6" do |form| %>
        <div class="space-y-2">
            <%= form.label :title %>
            <%= form.text_field :title, required: true, class: "border rounded p-2 w-full" %>
        </div>
        <div class="space-y-2">
            <%= form.label :description %>
            <%= form.text_area :description %>
        </div>
        <%# Time duration %>
        <div>
            <%= form.label :prep_time_minutes, "Preparation Time" %>
            <%= form.select :prep_time_minutes,
            {
                "Under 30 minutes" => 30,
                "Under 1 hour" => 60,
                "1-2 hours" => 120,
                "2+ hours" => 180
            },
            { prompt: "How long?" },
            { required: true } %>
            <%= form.label :cook_time_minutes, "Cooking Time" %>
            <%= form.select :cook_time_minutes,
            {
                "Under 30 minutes" => 30,
                "Under 1 hour" => 60,
                "1-2 hours" => 120,
                "2+ hours" => 180
            },
            { prompt: "How long?" },
            { required: true } %>
        </div>
        <%# Yield TODO: make scalable %>
        <div>
            <%= form.label :yield_amount, "How many servings?"%>
            <%= form.number_field :yield_amount,
                step: 0.25,
                min: 0,
                required: true,
                placeholder: "Amount" %>
            <%= form.text_field :yield_unit,
                required: true,
                placeholder: "servings/cups/etc" %>
        </div>
        <%# TODO: ingredients as autofill via db. TODO create new if not exist %>
        <div>
            <%= form.label :ingredient, "(not yet)Select ingredients and quantity" %>
            <%= form.check_box :ingredient %>
        </div>
        <%# Add Photo, optional. TODO: Backup image %>
        <div>
            <%= form.label :photo %>
            <%= form.file_field :photo, accept: 'image/*' %>
            <small class="form-text text-muted">Select an image file (JPG, PNG, etc.)</small>
        </div>
        <%# Instructions added as steps, saved as array of strings %>
        <div data-controller="steps">
            <%= form.label :instructions %>
            <div data-steps-target="container">
                <% (@recipe.instructions ||= [""]).each_with_index do |step, index| %>
                <div class="step-field">
                    <%= text_field_tag "recipe[instructions][]", step,
                        placeholder: "Step #{index + 1}",
                        class: "form-control mb-2" %>
                </div>
                <% end %>
            </div>
            <button type="button"
                data-action="click->steps#add"
                    class="bg-indigo-500 text-white px-4 py-2 rounded cursor-pointer hover:bg-indigo-600">
              Add Step
            </button>
        </div>
        <%# Add recipe notes, optional %>
        <div>
            <%= form.label :notes %>
            <%= form.text_area :notes %>
        </div>
        <%# Visibility, required %>
        <div>
            <%= form.label :private %>
            <%= form.check_box :private %>
        </div>
        <%# Add tags %>
        <div>
            <p>Select at least 1 tag</p>
            <%= form.collection_check_boxes :tag_ids, Tag.order(:name), :id, :name do |b| %>
                <div>
                    <%= b.check_box %>
                    <%= b.label %>
                </div>
            <% end %>

        </div>
        <div>
            <%= form.submit "Submit Recipe" %>
            <%= link_to "Back to Recipes", recipes_path %>
        </div>
    <% end %>
</div>
